<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ project_name }} - 2D Face Averaging</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,500;9..144,700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body data-step="upload">
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-grid"></div>

    <div class="app-wrapper">
      <!-- Sticky Header with Stepper -->
      <header class="sticky-header">
        <div class="container">
          <div class="hero-mini">
            <div class="hero-copy-mini">
              <span class="eyebrow-mini">{{ project_name }}</span>
              <span class="tagline-mini">{{ project_tagline }}</span>
            </div>
            <div class="server-info">
              <span class="server-badge">
                <span class="server-dot"></span>
                Server running
              </span>
              <span class="stop-hint" title="Press Ctrl+C in terminal to stop"
                >Press (in the terminal) <kbd>Ctrl</kbd>+<kbd>C</kbd> to
                stop</span
              >
            </div>
          </div>

          <ol class="stepper" aria-label="Workflow steps">
            <li class="step" data-step="upload">
              <span class="step-index">1</span>
              <span class="step-label">Add photos</span>
              <span class="step-hint">Upload your face images</span>
            </li>
            <li class="step" data-step="settings">
              <span class="step-index">2</span>
              <span class="step-label">Tune output</span>
              <span class="step-hint">Configure quality settings</span>
            </li>
            <li class="step" data-step="processing">
              <span class="step-index">3</span>
              <span class="step-label">Process</span>
              <span class="step-hint">Running face averaging</span>
            </li>
            <li class="step" data-step="result">
              <span class="step-index">4</span>
              <span class="step-label">Download</span>
              <span class="step-hint">Get your averaged face</span>
            </li>
          </ol>
        </div>
      </header>

      <main class="main-content">
        <div class="container">
          <!-- Upload Step -->
          <section class="panel upload-section" id="uploadSection">
            <div class="panel-header">
              <div>
                <h2>1. Add your photos</h2>
                <p class="panel-subtitle">
                  Front-facing portraits work best. You can also try the example
                  set if you just want to test.
                </p>
              </div>
              <span class="pill">JPEG / PNG</span>
            </div>

            <div class="upload-area" id="uploadArea">
              <svg
                class="upload-icon"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              <p class="upload-text">Drag & drop images here</p>
              <p class="upload-subtext">or tap to browse files</p>
              <input
                type="file"
                id="fileInput"
                multiple
                accept="image/jpeg,image/jpg,image/png"
                hidden
              />
            </div>

            <div class="file-toolbar">
              <div>
                <div class="file-summary" id="fileSummary">
                  0 files - 0 Bytes
                </div>
                <div class="file-notice" id="fileNotice"></div>
              </div>
              <div class="file-actions">
                <button
                  class="btn btn-ghost"
                  id="useExampleBtn"
                  type="button"
                  title="Load sample photos to test the tool"
                >
                  Use example photos
                </button>
                <button
                  class="btn btn-ghost"
                  id="addMoreBtn"
                  type="button"
                  title="Add more images to your selection"
                >
                  Add more
                </button>
                <button
                  class="btn btn-ghost"
                  id="clearFilesBtn"
                  type="button"
                  disabled
                  title="Remove all selected files"
                >
                  Clear list
                </button>
                <button
                  class="btn btn-danger"
                  id="cleanCacheBtn"
                  type="button"
                  title="Delete all uploaded and generated files from server"
                >
                  Clean server cache
                </button>
              </div>
            </div>

            <div class="file-list" id="fileList"></div>

            <div class="action-bar">
              <div class="action-hint">
                <svg
                  class="hint-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span
                  >Need at least 2 photos. 6-10 photos recommended for smoother
                  averages.</span
                >
              </div>
              <div class="cta-row">
                <button
                  class="btn btn-primary"
                  id="uploadBtn"
                  disabled
                  title="Upload selected photos and continue to settings"
                >
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                  </svg>
                  Upload & continue
                </button>
                <button
                  class="btn btn-secondary"
                  id="cleanResetBtn"
                  type="button"
                  disabled
                  title="Clear all files and start over"
                >
                  Clean up & reset
                </button>
              </div>
            </div>
          </section>

          <!-- Settings Step -->
          <section class="panel settings-section hidden" id="settingsSection">
            <div class="panel-header">
              <div>
                <h2>2. Tune the output</h2>
                <p class="panel-subtitle">
                  Choose a quality level and background. Advanced controls are
                  optional.
                </p>
              </div>
              <button
                class="btn btn-ghost"
                id="backToFilesBtn"
                type="button"
                title="Go back to file upload"
              >
                ← Back to files
              </button>
            </div>

            <div class="settings-grid">
              <div class="setting-group">
                <label for="qualityPreset">Quality Preset</label>
                <select id="qualityPreset" class="form-control">
                  <option value="fast">Fast (Preview)</option>
                  <option value="balanced">Balanced (Restoration)</option>
                  <option value="max" selected>Maximum (Default)</option>
                </select>
                <small class="help-text"
                  >Fast is quickest. Balanced and Maximum require enhancement
                  libraries; Maximum adds restoration + upscale.</small
                >
              </div>

              <div class="setting-group">
                <label for="sizePreset">Output Size</label>
                <select id="sizePreset" class="form-control">
                  <option value="small">Small (900x1200)</option>
                  <option value="medium">Medium (1200x1600)</option>
                  <option value="large" selected>Large (1600x2200)</option>
                </select>
              </div>

              <div class="setting-group">
                <label for="background">Background</label>
                <select id="background" class="form-control">
                  <option value="gray">Studio Gray</option>
                  <option value="white">Pure White</option>
                  <option value="black">Deep Black</option>
                </select>
              </div>
            </div>

            <details class="advanced-settings">
              <summary>
                Advanced settings <span class="advanced-badge">Optional</span>
              </summary>

              <div class="settings-grid">
                <div class="setting-group">
                  <label for="width">Width (px)</label>
                  <input
                    type="number"
                    id="width"
                    class="form-control"
                    value="1600"
                    min="400"
                    max="4000"
                  />
                </div>

                <div class="setting-group">
                  <label for="height">Height (px)</label>
                  <input
                    type="number"
                    id="height"
                    class="form-control"
                    value="2200"
                    min="400"
                    max="4000"
                  />
                </div>
                <div class="setting-group">
                  <label for="feather">Feather</label>
                  <input
                    type="number"
                    id="feather"
                    class="form-control"
                    value="19"
                    min="0"
                    max="50"
                  />
                  <small class="help-text">Edge smoothing (0-50).</small>
                </div>

                <div class="setting-group">
                  <label for="sharpen">Sharpen</label>
                  <input
                    type="number"
                    id="sharpen"
                    class="form-control"
                    value="0.25"
                    min="0"
                    max="2"
                    step="0.1"
                  />
                  <small class="help-text">Detail enhancement (0-2).</small>
                </div>

                <div class="setting-group">
                  <label for="exportScale">Export Scale</label>
                  <input
                    type="number"
                    id="exportScale"
                    class="form-control"
                    value="1.0"
                    min="0.5"
                    max="4"
                    step="0.1"
                  />
                  <small class="help-text">Final upscaling (0.5-4).</small>
                </div>
              </div>
            </details>

            <div class="action-bar">
              <div class="action-hint">
                <svg
                  class="hint-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polygon
                    points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"
                  ></polygon>
                </svg>
                <span
                  >Default settings use Maximum quality with Large output for
                  best results.</span
                >
              </div>
              <div class="cta-row">
                <button
                  class="btn btn-primary"
                  id="processBtn"
                  title="Start the face averaging process with selected settings"
                >
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                  Generate averaged face
                </button>
                <button
                  class="btn btn-secondary"
                  id="resetFromSettingsBtn"
                  type="button"
                  title="Start over with new photos"
                >
                  Start over
                </button>
              </div>
            </div>
          </section>

          <!-- Processing Step -->
          <section
            class="panel processing-section hidden"
            id="processingSection"
          >
            <div class="panel-header">
              <div>
                <h2>3. Processing</h2>
                <p class="panel-subtitle">
                  This can take a minute or two depending on your quality
                  settings and photo count.
                </p>
              </div>
              <span class="pill processing-pill">
                <span class="spinner-small"></span>
                Working
              </span>
            </div>

            <div class="progress-container">
              <div class="spinner-large">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
              </div>
              <p class="progress-text" id="progressText">
                Initializing face alignment pipeline...
              </p>
              <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
              </div>
              <p class="progress-percent" id="progressPercent">0%</p>
            </div>

            <div class="log-panel">
              <div class="log-header">
                <span>Live logs</span>
                <button
                  class="btn btn-ghost btn-small"
                  id="toggleLogsBtn"
                  type="button"
                >
                  Show/Hide
                </button>
              </div>
              <pre class="log-output" id="logOutput">Waiting for logs...</pre>
            </div>

            <div class="action-bar processing-actions">
              <div class="action-hint">
                <svg
                  class="hint-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span
                  >Processing time depends on photo count and quality preset.
                  Maximum quality takes longer.</span
                >
              </div>
              <div class="cta-row">
                <button
                  class="btn btn-danger"
                  id="cancelBtn"
                  type="button"
                  title="Cancel the current processing job"
                >
                  Cancel job
                </button>
                <button
                  class="btn btn-secondary"
                  id="resetFromProcessingBtn"
                  type="button"
                  title="Start over with new settings"
                >
                  Start over
                </button>
              </div>
            </div>
          </section>

            <!-- Result Step -->
            <section class="panel result-section hidden" id="resultSection">
              <div class="result-fullscreen">
                <div class="result-header">
                  <h2>Your Result</h2>
                  <span class="success-badge">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="3"
                    >
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Complete
                  </span>
                </div>

                <div class="result-image-area">
                  <img
                    id="resultImage"
                    alt="Averaged face"
                    class="result-image"
                  />
                </div>

                <div class="result-actions-bar">
                  <div class="result-actions">
                    <a
                      id="downloadBtn"
                      class="btn btn-success"
                      download="averaged_face.jpg"
                      title="Download the averaged face image"
                    >
                      <svg
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                        ></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                      </svg>
                      Download
                    </a>
                    <button
                      class="btn btn-secondary"
                      id="startOverBtn"
                      type="button"
                      title="Start a new batch with different photos"
                    >
                      New Batch
                    </button>
                  </div>
                </div>
              </div>
            </section>

          <!-- Error Step -->
          <section class="panel error-section hidden" id="errorSection">
            <div class="panel-header">
              <div>
                <h2>Something went wrong</h2>
                <p class="panel-subtitle">
                  Review the message below or start a new batch.
                </p>
              </div>
              <span class="pill pill-error">Error</span>
            </div>
            <div class="error-container">
              <p class="error-text" id="errorText"></p>
            </div>
            <div class="log-panel">
              <div class="log-header">Last logs</div>
              <pre class="log-output" id="errorLogOutput">
No logs captured.</pre
              >
            </div>
            <div class="action-bar">
              <div class="action-hint error-hint">
                <svg
                  class="hint-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <span
                  >Check the logs for details. Common issues: unsupported image
                  formats, too few photos, or missing enhancement
                  libraries.</span
                >
              </div>
              <div class="cta-row">
                <button
                  class="btn btn-secondary"
                  id="errorStartOverBtn"
                  type="button"
                  title="Clear everything and start fresh"
                >
                  Start over
                </button>
              </div>
            </div>
          </section>
        </div>
      </main>

      <!-- Keyboard Shortcuts Help (Hidden by default) -->
      <div class="shortcuts-modal hidden" id="shortcutsModal">
        <div class="shortcuts-backdrop" id="shortcutsBackdrop"></div>
        <div class="shortcuts-content">
          <div class="shortcuts-header">
            <h3>Keyboard Shortcuts</h3>
            <button
              class="btn btn-ghost btn-small"
              id="closeShortcutsBtn"
              type="button"
            >
              ×
            </button>
          </div>
          <div class="shortcuts-list">
            <div class="shortcut-item">
              <kbd>Esc</kbd>
              <span>Close modals / Cancel</span>
            </div>
            <div class="shortcut-item">
              <kbd>Ctrl</kbd> + <kbd>C</kbd>
              <span>Stop server (in terminal)</span>
            </div>
            <div class="shortcut-item">
              <kbd>?</kbd>
              <span>Show this help</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer>
        <p>
          {{ project_name }} - Upload at least 2 portrait images for best
          results.
        </p>
        <p class="footer-links">
          <button class="btn-link" id="shortcutsBtn" type="button">
            Keyboard shortcuts
          </button>
          <span class="footer-divider">•</span>
          <span
            >Processing is 100% local - your photos never leave your device</span
          >
        </p>
      </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
